@model IList<ARS.Models.Flight>

@{
    ViewBag.Title = "Choose Flights";
    Layout = "~/Views/Shared/_MyLayout.cshtml";
}

<div class="body container">
    @*<h2>@Model.FirstOrDefault().FromAirport.CityAirports.First().City.name</h2>*@
    <h2>@ViewBag.Title</h2>

    <p class="text-success">@ViewBag.StatusMessage</p>
    <div class="container">
        @*<h4>Depart @Model.First().FromAirport.CityAirports.First().City.name, @Model.First().FromAirport.CityAirports.First().City.country to @Model.First().ToAirport.CityAirports.First().City.name, @Model.First().ToAirport.CityAirports.First().City.country</h4>*@
        @*<h5>@Model.First().departureDate.ToString("D")</h5>*@
        <hr />
        <div id="flightResultsContainer">
            <ul class="search-result">
                @foreach (var item in Model)
                {
                    <li>
                        <div class="tripInfo row">
                            <div class="col-lg-6">
                                <div class="row">
                                    <div class="col-lg-4">
                                        <span class="airport-code">BHM</span>
                                    </div>
                                    <div class="col-lg-4">
                                        <span class="airport-code">YYC</span>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-3">
                                        <span class="flight-time">
                                            @item.departureDate.ToString("t")
                                        </span>
                                    </div>
                                    <div class="col-lg-1">
                                        <span aria-hidden="true" class="glyphicon-arrow-right"></span>
                                    </div>
                                    <div class="col-lg-3">
                                        <span class="flight-time">
                                            @item.arrivalDate.ToString("t")
                                        </span>
                                    </div>
                                    <div class="col-lg-3">
                                        <div class="flight-duration">
                                            @item.flyTime
                                            <span>h</span>
                                        </div>
                                    </div>
                                    @if (item.haveStop)
                                    {
                                        <div class="col-lg-2">
                                            <div class="flight-stop">
                                                <div class="num-tooltip">
                                                    <button id="flight1StopCountLink_desktop" class="stop-count">
                                                        1 Stop
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">

                                        </div>
                                    }
                                </div>
                            </div>
                            <div class="col-lg-6"></div>
                        </div>
                    </li>
                }
            </ul>
            <button type="button" id="flightSeat">Pick Seat</button>
            <input type="text" name="valueDeparture" id="valueDeparture" hidden="true" />

            @*<table>
                    <thead>
                        <th></th>
                        <th>PlaneCode</th>
                        <th>FromAirport</th>
                        <th>ToAirport</th>
                        <th>Distance</th>
                        <th>Price</th>
                        <th>SeatAvailable</th>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td><a href="/Flight/Place/@item.id">Seats</a></td>
                                <td>@item.planeCode</td>
                                <td>
                                    @foreach (var city in item.FromAirport.CityAirports)
                                    {
                                        @city.City.name
                                    }
                                </td>
                                <td>
                                    @foreach (var city in item.ToAirport.CityAirports)
                                    {
                                        @city.City.name
                                    }
                                </td>
                                <td>
                                    @item.distance
                                </td>
                                <td>
                                    @string.Format("{0:C0}", item.price)
                                </td>
                                <td>
                                    @item.seatAvaiable
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>*@
        </div>
    </div>
    <div class="modal fade" id="ModalPopUpArrival" role="dialog">
        <div class="modal-dialog err-pop" style="">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 style="color: black;">Booking Seat</h1>
                    <button id="DivClose" type="button" class="close" style="position: absolute; top: 20px; right: 20px;" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body" style="height: auto;width:100%">
                    <h4 style="color: black;">Please choose seat</h4>
                    <div class="content" style="display:flex">
                        <link href="~/Content/selecting-seat.css" rel="stylesheet" />

                        <div class="plane">
                            <div class="cockpit">
                                <h1>Please select a seat</h1>
                            </div>
                            <form id="sform">
                                <div id="holder">
                                    <ul id="place">
                                    </ul>
                                </div>
                                <div style="float:left;">
                                    <ul id="seatDescription">
                                        <li style="background:url('http://starqistna.com/images/available_seat_img1.gif') no-repeat scroll 0 0 transparent;">
                                            Available Seat
                                        </li>
                                        <li style="background:url('http://starqistna.com/images/booke2d_seat_img.gif') no-repeat scroll 0 0 transparent;">
                                            Booked Seat
                                        </li>
                                        <li style="background:url('http://starqistna.com/images/selected_s3eat_img.gif') no-repeat scroll 0 0 transparent;">
                                            Selected Seat
                                        </li>
                                    </ul>
                                </div>

                                <div class="modal fade" id="staticBackdrop" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="staticBackdropLabel">Alert</h4>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body">
                                                <p id="content">This seat is already reserved</p>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>

                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div id="list">

                                </div>
                                <button class="btn btn-primary" id="orderSeat" type="button" style="margin-top:10px">Submit</button>
                            </form>
                            <input type="text" name="valueSeat" id="valueSeat" hidden="true" />
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $('#flightSeat').click(function () {
            $('#ModalPopUpArrival').modal('show')
            var bookedSeats = [];
            var bookedSeatsdata = [];
            $.ajax({
                type: "GET",
                url: "/Flight/Place/2",
                datatype: "Json",
                success: function (data) {
                    console.log(data)
                    for (var i = 0; i < data.length; i++) {
                        var position = data[i].position;
                        bookedSeats.push(position)
                    }
                    var economyPosition = 14;
                    var infomationBooking = {
                        qualifi: 9,
                        typeSeat: 5
                    }
                    var settings = {
                        rows: 18,
                        cols: 6,
                        rowCssPrefix: 'row-',
                        colCssPrefix: 'col-',
                        seatWidth: 50,
                        seatHeight: 50,
                        seatCss: 'seat',
                        selectedSeatCss: 'selectedSeat',
                        selectingSeatCss: 'selectingSeat',
                        typeTicket: '',
                        qualifi: 4
                    };

                    var init = function (reservedSeat) {
                        var str = [],
                            seatNo, className;
                        //Bussiness = 1, FirstClass = 2, ClubClass = 3, Smoking = 4, NonSmoking = 5
                        // 10               10              30             40           50

                        // First class 12 - 2 rows
                        // ClubClass = 12 - 2 rows next
                        // NonSmoking = 24 - 4 rows next
                        // Bussiness = 36 - 6 rows next
                        // Smoking = 24 - 4 rows next
                        for (i = 0; i < settings.rows; i++) {
                            if (i == 0) {
                                settings.typeTicket = 2
                                str.push('<li class="infomation-seat" ><div class="exit exit--back fuselage"><span style= "position: relative;vertical-align: -webkit-baseline-middle;top: 10px;">FIRST Class</span></div></li>')
                            }
                            if (i == 2) {
                                settings.typeTicket = 3
                                str.push('<li class="infomation-seat" ><div class="exit exit--back fuselage"><span style= "position: relative;vertical-align: -webkit-baseline-middle;top: 10px;">CLUB CLASSES</span></div></li>')
                            }
                            if (i == 4) {
                                settings.typeTicket = 5
                                str.push('<li class="infomation-seat" ><div class="exit exit--back fuselage"><span style= "position: relative;vertical-align: -webkit-baseline-middle;top: 10px;">NON SMOKING CLASSES</span></div></li>')
                            }
                            if (i == 6) {
                                settings.typeTicket = 1
                                str.push('<li class="infomation-seat" ><div class="exit exit--back fuselage"><span style= "position: relative;vertical-align: -webkit-baseline-middle;top: 10px;">BUSSINESS CLASSES</span></div></li>')
                            }
                            if (i == economyPosition - 1) {
                                settings.typeTicket = '4'
                                str.push('<li class="infomation-seat"><div class="exit exit--back fuselage"><span style= "position: relative;vertical-align: -webkit-baseline-middle;top: 10px;">SMOKING CLASSES</span></div></li>')
                            }

                            for (j = 0; j < settings.cols; j++) {
                                seatNo = (i + 1 + String.fromCharCode(65 + j));
                                className = settings.seatCss + ' ' + settings.rowCssPrefix + i.toString() + ' ' + settings.colCssPrefix + j.toString() + ' ' + settings.typeTicket;
                                if ($.isArray(reservedSeat) && $.inArray(seatNo, reservedSeat) != -1) {
                                    className += ' ' + settings.selectedSeatCss;
                                }
                                str.push('<li class="' + className + '"' +
                                    'style="top:' + (i * settings.seatHeight).toString() + 'px;left:' + (j * settings.seatWidth).toString() + 'px">' +
                                    '<a title="' + seatNo + '"name="' + settings.typeTicket + '">' + seatNo + '</a>' +
                                    '</li>');

                            }
                        }
                        $('#place').html(str.join(''));
                    };
                    init(bookedSeats);
                    $('.' + settings.seatCss).click(function () {
                        if ($(this).hasClass(settings.selectedSeatCss)) {
                            $('#staticBackdrop').modal('show')

                        } else {
                            $(this).toggleClass(settings.selectingSeatCss);
                        }
                        $('#list').empty();
                    });
                    $('#orderSeat').click(function () {
                        var str = [], str2 = [],
                            item, classItem;
                        $.each($('#place li.' + settings.selectingSeatCss + ' a'), function (index, value) {
                            item = $(this).attr('title');
                            classItem = $(this).attr('name')
                            str.push(item);
                            str2.push(classItem)
                        });
                        var querystring = '&seatCode=' + str.join() + '&type=' + str2.join();
                        $('#valueSeat').val(querystring)
                        $('#ModalPopUpArrival').modal('hide')
                        $('#ModalPopUpArrival').on('hidden.bs.modal', function (e) {
                            var sel = $('#valueSeat').val();
                            $('#valueDeparture').html(sel)
                        });
                    });
                }
            });

  
        })
    })
</script>